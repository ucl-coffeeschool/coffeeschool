<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Lesson 7 - Coffee School</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link href="css/main.css" rel="stylesheet">
    <link href="css/prism.css" rel="stylesheet">
    <script src="js/prism.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>
    <!-- nav stuff. -->
    <nav>
        <a href="index.html">Home</a>
        <a href="sections.html" class="active">Sections</a>
        <a href="about.html">About</a>
    </nav>

    <div class="nagbar" style="display:none">
        <p>Your code doesn't seem to do what we're looking for. Check it and try again!</p>
        <i class="fa fa-close"></i>
    </div>

    <!-- Main content. -->
    <div class="overlay" style="display:none">
        <span class="closeButton"><i class="fa fa-close"></i></span>
            <h1>Lesson completed!</h1>
            <h2>Give yourself a pat on the back.</h2>
            <a href="section-Environment and Obstacles-lesson-part3-1.html">Next lesson!</a>
    </div>
    <div class="main">
        <header>
            <div id="menu-button"><i class="fa fa-bars"></i></div>
            <h1>Coffee School <i class="fa fa-code"></i><em></em></h1>
        </header>
        <div class="container">
            <div class="flex-container div-half">
                <h2>Code Editor <button id="code-compile"><i class="fa fa-play"></i> Update</button><span id="syntax-msg"></span>
                        <button id="nextLesson" onClick="window.location = 'section-Environment and Obstacles-lesson-part3-1.html'"><i class="fa fa-arrow-right"></i> Next Lesson</button>
                        </h2>

                <div id="codeEditor">// Creating environment variables
var playerSize = 10;
var sceneWidth = 300, sceneHeight = 150;
var groundHeight = 10;
var playAreaHeight = (sceneHeight - groundHeight);
// Create the variables to track player movement
var playerVel = 0; // Stores the player&#x27;s velocity
var g = 0.4;       // The constant acceleration cause by &quot;gravity&quot;
// Object width!
var objectWidth = 2 * playerSize;
// Obstacle Counter
var obstacleCounter = 0;

// Create the ground!
Crafty.e(&quot;Solid, 2D, DOM, Color&quot;)
    .attr({x: 0,
           y: playAreaHeight,
           w: sceneWidth,
           h: groundHeight})
    .color(&quot;#00ff00&quot;);

// Create our player&#x27;s base entity
Crafty.e(&quot;2D, DOM, Color&quot;) // Specifying the components to add
    .attr({x: 30, y: 30, w: playerSize, h: playerSize}) // Specifying the dimensions and the point to draw from
    .color(&quot;#ff0000&quot;) // Specifying the colour of the rectangle
    .bind(&quot;EnterFrame&quot;, function() { // Binds the &quot;EnterFrame&quot; event to the entity
        if(this.y &lt; 0) {
          playerVel = g; // Prevent the player from going above the game screen
        }
        else {
          playerVel += g; // Adds the &quot;gravitational acceleration&quot; to the player&#x27;s velocity
        }

        this.y += playerVel; // Change the player entities y position based on the player velocity
    })
    .bind(&quot;KeyDown&quot;, function(event) { // Binds the &quot;KeyDown&quot; event to our player entity
        if(event.key == Crafty.keys.SPACE){ // If the key is the spacebar then &quot;flap&quot;
            playerVel = -5; // Sets the player&#x27;s speed and direction to go upwards
        }
    })
    .bind(&quot;EnterFrame&quot;, function() {
        if(obstacleCounter &gt; 100){
            obstacleCounter = 0;
            newObstacle();
        }
        obstacleCounter++;
    });

function newObstacle()
{
    var randomHeight = Math.floor((Math.random() * (sceneHeight/2)) + (sceneHeight/3));
    var bottomOfTopHalf = playAreaHeight - randomHeight;
    var topOfBottomHalf = bottomOfTopHalf + (4 * playerSize);

    // Create the top half of the pipe
    Crafty.e(&quot;Obstacle, 2D, DOM, Color, Solid&quot;)
        .attr({x: sceneWidth,
               y: 0,
               w: objectWidth,
               h: bottomOfTopHalf})
        .color(&quot;#003319&quot;);

    // Create the bottom half of the pipe
    Crafty.e(&quot;Obstacle, 2D, DOM, Color, Solid&quot;)
        .attr({x: sceneWidth,
               y: topOfBottomHalf,
               w: objectWidth,
               h: playAreaHeight - topOfBottomHalf})
        .color(&quot;#003319&quot;);
}
</div>
            </div>
            <div class="flex-container div-half">
                <div class="flex-container">
                    <h2>Preview</h2>
                    <div class="div-content" id="game-container">
                    </div>
                    <h2>Console Log:</h2>
                    <div class="div-content" id="log-div"> </div>
                    <div class="div-content">
                        <h1></h1>
                        <h2 id="task-b-moving-the-obstacles-">Task B: Moving the obstacles!</h2>
<h3 id="goal-move-the-obstacles-every-game-loop-">Goal: Move the obstacles every game loop!</h3>
<p>Now that we’re generating obstacles we need to move them across the scene towards the player. We can do this in the same <code>EnterFrame</code> event bind as we used for the <code>obstacleCounter</code> code.</p>
<p>Earlier, we gave each obstacle the <code>Obstacle</code> component: Our own component label. This component label is not part of Crafty by default and we haven’t made any code that gives it behaviour. However what we can do is use it as a label to access all of the obstacle entities we made!</p>
<p>Crafty has a function <code>each</code> that goes through the each entity that has the given component and performs a function. We’re going to use this to move every obstacle to the left each game loop. We want to place this in our most recent <code>EnterFrame</code> block:</p>
<pre><code class="lang-javascript">.bind(&quot;EnterFrame&quot;, function() {
    Crafty(&quot;Obstacle&quot;).each(function() {
        this.x -= 3;
    });

    // Obstacle generation code lives here
});
</code></pre>
<p>What should happen here is that each obstacle that we’ve made will move to the left 3 pixels each frame. You can try different values to change the speed of the obstacles. </p>
<p>If we leave the code as it is, what happens to obstacles when they go off the screen? <em>They will keep moving and stay in the game, out of sight.</em> This means that after a while there will be <em>lots</em> of obstacles to draw and move for the player’s computer, causing lag.</p>
<p>To fix this we can make Crafty <code>destroy</code> the object, removing it entirely. But when do we want to destroy the object? If we remove it when its <code>x</code> location is 0 what happens?</p>
<p>To destroy the object when it’s not visible we need to remove it when its <code>x</code> position is its width, but negative. If we use an <code>if else</code> clause then the game can check if the obstacle needs to be destroyed and if not the game will move it to the left.</p>
<pre><code class="lang-javascript">.bind(&quot;EnterFrame&quot;, function() {
    Crafty(&quot;Obstacle&quot;).each(function() {
        if(this.x &lt; -objectWidth) {
            this.destroy();
        }        
        else {
            this.x -= 3;
        }
    });

    // Let there be obstacles!
});
</code></pre>
<p>With this the game should start generating obstacles and moving them across the screen. <em>Why don’t you try it out and see what happens?</em></p>
<p>Now that we’ve got our ground and obstacles we can “pretty up” our game a smidge by setting a background colour for crafty. We can set the Crafty’s background using <code>Crafty.background();</code> before we create our entities (like the ground, player and obstacles).</p>
<p>To set the background to a light blue colour we can add the following code after our variables but before our entities:</p>
<pre><code class="lang-javascript">Crafty.background(&quot;#ADD8E6&quot;);
</code></pre>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script defer>
        $(document).ready(function() {
    $('#nextLesson, #sectionButton').addClass("lessonComplete");
});

var codeTest = function() {
    return "notest";
}

    </script>
    <!-- Editor (ace) -->

    <script type="text/javascript" src="https://rawgithub.com/craftyjs/Crafty/release/dist/crafty-min.js"></script>
    <script src="https://cdn.jsdelivr.net/ace/1.2.3/min/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/main.js" type="text/javascript" charset="utf-8"></script>
</body>

</html>
